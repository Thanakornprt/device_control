import time
import re
import speech_recognition as sr

start_time = None  # ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°
elapsed_time = 0   # ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
def start_stopwatch():
    global start_time
    start_time = time.time()
    print("‚è±Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤...")

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
def stop_stopwatch():
    global start_time
    if start_time is None:
        print("‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤!")
    else:
        elapsed_time = time.time() - start_time
        print(f"‚èπÔ∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ: {elapsed_time:.2f} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        start_time = None  # reset

# --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Speech Recognition ---
r = sr.Recognizer()
with sr.Microphone() as mic:
    r.adjust_for_ambient_noise(mic, duration=0.6)
    print("üé§ ‡∏û‡∏π‡∏î‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡πÄ‡∏ä‡πà‡∏ô '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ', '‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô ‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤', ‡∏´‡∏£‡∏∑‡∏≠ '‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô ‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤'")

    while True:
        try:
            audio = r.listen(mic, timeout=6, phrase_time_limit=10)
            text = r.recognize_google(audio, language="th-TH").strip().lower()
            print("‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô :", text)

            if text.startswith("‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ"):
                # ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                cmd = text.replace("‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ", "", 1).strip()
                print("üëã ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡∏∏‡∏ì‡∏ò‡∏ô‡∏Å‡∏£!", end="")
                if cmd:
                    print(f" ‡∏Ñ‡∏∏‡∏ì‡∏û‡∏π‡∏î‡∏ï‡πà‡∏≠‡∏ß‡πà‡∏≤: {cmd}")
                else:
                    print()

            elif text in ["‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô ‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤", "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤", "start stopwatch"]:
                start_stopwatch()

            elif text in ["‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô ‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤", "‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤", "stop stopwatch"]:
                stop_stopwatch()

            elif text in ["‡∏≠‡∏≠‡∏Å", "‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°", "exit"]:
                print("üëã ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô")
                break

            else:
                # ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤)
                m = re.search(r"(\d+)", text)
                if m:
                    angle = int(m.group(1))
                    print(f"üìè ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏°‡∏∏‡∏°: {angle}")
                else:
                    print("‚ùì ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á")

        except sr.WaitTimeoutError:
            print("‚è≥ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤")

        except sr.UnknownValueError:
            print("ü§î ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à ‡∏•‡∏≠‡∏á‡∏û‡∏π‡∏î‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á")
